(()=>{"use strict";var t={144:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TinyMCEField=void 0;const n=i(311),s=(t,e={})=>{let i;return()=>{void 0===i?i=Craft.createElementSelectorModal(t,Object.assign({resizable:!0,multiSelect:!1,disableOnSelect:!0},e)):i.show()}},o=(t,e,i,n,s)=>({title:t,body:{type:"panel",items:e},buttons:[{type:"cancel",name:"cancel",text:Craft.t("tinymce","Cancel")},{type:"submit",name:"submit",text:Craft.t("tinymce","Save"),buttonType:"primary"}],initialData:i,onChange:n,onSubmit:s});e.TinyMCEField=class{constructor(t){this._settings=t;const e=this._settings,i=Object.assign({skin:"craft",plugins:"autoresize lists link image code",content_css:!1,menubar:!1,statusbar:!1,toolbar:"undo redo | blocks | bold italic strikethrough | bullist numlist | insertLink insertImage | hr | code",contextmenu:"craftLink linkchecker image editimage table spellchecker configurepermanentpen",allow_conditional_comments:!1,element_format:"html",fix_list_elements:!0,relative_urls:!1,remove_script_host:!1,anchor_top:!1,anchor_bottom:!1,autoresize_bottom_margin:0},this._settings.editorConfig,{selector:`#${this._settings.id}`,language:this._settings.language,directionality:this._settings.direction,setup:t=>{this.editor=t,this._setup()},init_instance_callback:t=>{this.editor=t,this._init();const i=e.editorConfig.init_instance_callback;"function"==typeof i&&i.apply(this,arguments)}});tinymce.init(i).then((()=>{}),(()=>{}))}_commandHandleFromElementType(t){var e;return null===(e=t.split("\\").pop())||void 0===e?void 0:e.toLowerCase()}_setup(){const t=[],e=[];for(const{elementType:i,optionTitle:n,sources:o}of this._settings.linkOptions){const r=this._commandHandleFromElementType(i),a=`${r}Link`,l=s(i,{sources:o,criteria:{locale:this._settings.locale},onSelect:([t])=>{const e=this.editor.selection.getContent();this.editor.windowManager.open(this._linkDialogConfig(n,!1,{url:`${t.url}#${r}:${t.id}@${this._settings.elementSiteId}:url`,text:e.length>0?e:String(t.label),site:this._settings.elementSiteId}))}});t.push({type:"menuitem",text:n,onAction:()=>l()}),this.editor.ui.registry.addMenuItem(a,{icon:"link",text:n,onAction:()=>l()}),e.push(a)}t.push({type:"menuitem",text:Craft.t("tinymce","Insert/edit link"),onAction:()=>this.editor.execCommand("mceLink")}),this.editor.ui.registry.addMenuButton("insertLink",{icon:"link",tooltip:Craft.t("tinymce","Link"),fetch:e=>e(t)});const i=Craft.t("tinymce","Edit link");this.editor.ui.registry.addMenuItem("editLink",{icon:"link",text:i,onAction:t=>{var e,n;const s=this.editor.dom.getParent(this.editor.selection.getStart(),"a[href]"),o=null!==(e=null==s?void 0:s.getAttribute("href"))&&void 0!==e?e:"",r=o.match(/@([0-9]+)(:url)$/);this.editor.selection.select(s),this.editor.windowManager.open(this._linkDialogConfig(i,!0,{url:o,text:null!==(n=null==s?void 0:s.textContent)&&void 0!==n?n:"",site:null!==r?r[1]:this._settings.elementSiteId}))}}),this.editor.ui.registry.addContextMenu("craftLink",{update:t=>{const i=this.editor.dom.getParents(t,"a");if(0===i.length)return`${e.join(" ")} link`;return(i.some((t=>t.href.endsWith(":url")))?"editLink":"link")+" unlink openlink"}});const n=Craft.t("tinymce","Insert an image");this.editor.ui.registry.addButton("insertImage",{icon:"image",tooltip:n,onAction:()=>s("craft\\elements\\Asset",{sources:this._settings.volumes,transforms:this._settings.transforms.map((t=>({handle:t.value,name:t.text}))),storageKey:"RichTextFieldType.ChooseImage",criteria:{locale:this._settings.locale,kind:"image"},onSelect:([t],e=null)=>{const i=this.editor.selection.getContent(),s=[{value:"",text:Craft.t("tinymce","No transform")}];s.push(...this._settings.transforms),this.editor.windowManager.open(o(n,[{type:"input",name:"title",label:Craft.t("tinymce","Title")},{type:"input",name:"caption",label:Craft.t("tinymce","Caption")},{type:"input",name:"link",label:Craft.t("tinymce","Link")},{type:"checkbox",name:"newTab",label:Craft.t("tinymce","Open in new tab?")},{type:"selectbox",name:"transform",label:Craft.t("tinymce","Transform"),items:s}],{transform:null!=e?e:this._settings.defaultTransform},(()=>{}),(e=>{const n=e.getData(),s=i.length>0?"mceReplaceContent":"mceInsertContent",o=n.title.length>0,r=n.caption.length>0,a=n.link.length>0,l=""!==n.transform,c=[l?t.url.replace(/\/([^/]+)$/,`/_${n.transform}/$1`):t.url,`#asset:${t.id}`,l?`:transform:${n.transform}`:""].join(""),m=["<figure>",a?`<a href="${n.link}"${n.newTab?' target="_blank"':""}>`:"",`<img src="${c}"${o?`alt="${n.title}"`:""}>`,a?"</a>":"",r?`<figcaption>${n.caption}</figcaption>`:""].join("");this.editor.execCommand(s,!1,m),e.close()})))}})()})}_init(){const t=n(this.editor.container),e=n(this.editor.formElement);this.editor.on("focus",(e=>t.addClass("mce-focused"))),this.editor.on("blur",(e=>t.removeClass("mce-focused")));const i=e.data("elementEditor");new window.MutationObserver((()=>{n(this.editor.targetElm).val(this.editor.getContent());(i.isFullPage?Garnish.$bod:e).trigger("change")})).observe(this.editor.getBody(),{characterData:!0,childList:!0,subtree:!0}),this.editor.addShortcut("meta+s","",(()=>Garnish.uiLayerManager.triggerShortcut(new KeyboardEvent("keydown",{shiftKey:!1,metaKey:!0,ctrlKey:!0,altKey:!1,keyCode:Garnish.S_KEY})))),this.editor.addShortcut("shift+meta+s","",(()=>Garnish.uiLayerManager.triggerShortcut(new KeyboardEvent("keydown",{shiftKey:!0,metaKey:!0,ctrlKey:!0,altKey:!1,keyCode:Garnish.S_KEY}))))}_linkDialogConfig(t,e,i){const n=this.editor.selection.getContent();return o(t,[{type:"input",name:"url",label:Craft.t("tinymce","URL"),enabled:!1},{type:"input",name:"text",label:Craft.t("tinymce","Text")},{type:"checkbox",name:"newTab",label:Craft.t("tinymce","Open in new tab?")},{type:"selectbox",name:"site",label:Craft.t("tinymce","Site"),items:this._settings.allSites}],i,(t=>{const e=t.getData();t.setData({url:e.url.replace(/@([0-9]+)(:url)$/,`@${e.site}:url`)})}),(t=>{const i=t.getData(),s=e||n.length>0?"mceReplaceContent":"mceInsertContent",o=`<a href="${i.url}" title="${i.text}"${i.newTab?' target="_blank"':""}>${i.text}</a>`;this.editor.execCommand(s,!1,o),t.close()}))}}},311:t=>{t.exports=jQuery}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}(()=>{const t=i(144);window.initTinyMCE=e=>new t.TinyMCEField(e)})()})();
//# sourceMappingURL=input.js.map